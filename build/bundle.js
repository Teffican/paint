var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function r(t){t.parentNode&&t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function d(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function p(t){return""===t?null:+t}function $(t,e){t.value=null==e?"":e}function g(t,e,n){t.classList[n?"add":"remove"](e)}let v;function m(t){v=t}function x(t){(function(){if(!v)throw new Error("Function called outside component initialization");return v})().$$.on_mount.push(t)}const y=[],b=[],w=[],C=[],k=Promise.resolve();let _=!1;function F(t){w.push(t)}const S=new Set;let T=0;function E(){const t=v;do{for(;T<y.length;){const t=y[T];T++,m(t),W(t.$$)}for(m(null),y.length=0,T=0;b.length;)b.pop()();for(let t=0;t<w.length;t+=1){const e=w[t];S.has(e)||(S.add(e),e())}w.length=0}while(y.length);for(;C.length;)C.pop()();_=!1,S.clear(),m(t)}function W(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(F)}}const L=new Set;function R(t,e){t&&t.i&&(L.delete(t),t.i(e))}function j(t,e,n,o){if(t&&t.o){if(L.has(t))return;L.add(t),undefined.c.push((()=>{L.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}const A="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function M(t){t&&t.c()}function N(t,n,l,c){const{fragment:s,after_update:r}=t.$$;s&&s.m(n,l),c||F((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),r.forEach(F)}function P(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function z(t,e){-1===t.$$.dirty[0]&&(y.push(t),_||(_=!0,k.then(E)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(e,i,l,c,s,a,u,f=[-1]){const d=v;m(e);const h=e.$$={fragment:null,ctx:[],props:a,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:i.target||d.$$.root};u&&u(h.root);let p=!1;if(h.ctx=l?l(e,i.props||{},((t,n,...o)=>{const i=o.length?o[0]:n;return h.ctx&&s(h.ctx[t],h.ctx[t]=i)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](i),p&&z(e,t)),n})):[],h.update(),p=!0,o(h.before_update),h.fragment=!!c&&c(h.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);h.fragment&&h.fragment.l(t),t.forEach(r)}else h.fragment&&h.fragment.c();i.intro&&R(e.$$.fragment),N(e,i.target,i.anchor,i.customElement),E()}m(d)}class I{$destroy(){P(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const O={lineWidth:null,strokeColor:"#000000",fillColor:"#ffffff",figure:"pen",isFill:!1},q=[{value:"pen",title:"Карандаш",action:(t,e,n,o,i)=>{t.moveTo(e.x,e.y),i(),t.lineTo(e.x,e.y)}},{value:"line",title:"Линия",action:(t,e,n,o)=>{t.moveTo(e.x,e.y),t.lineTo(n,o)}},{value:"rect",title:"Прямоугльник",action:(t,e,n,o)=>{O.isFill&&t.fillRect(e.x,e.y,n-e.x,o-e.y),t.rect(e.x,e.y,n-e.x,o-e.y)}},{value:"ellipse",title:"Овал",action:(t,e,n,o)=>{const i=Math.abs(n-e.x),l=Math.abs(o-e.y);t.save(),t.translate(e.x,e.y),t.scale(1,l/i),t.arc(0,0,i,0,2*Math.PI),t.restore(),O.isFill&&t.fill()}},{value:"triangle",title:"Треугольник",action:(t,e,n,o)=>{t.moveTo(e.x,e.y),t.lineTo(n,o),t.lineTo(e.x-(n-e.x),o),O.isFill&&t.fill(),t.closePath()}}],{window:X}=A;function Y(e){let n,i,l;return{c(){n=a("canvas"),h(n,"class","svelte-1qryt67")},m(t,o){s(t,n,o),e[6](n),i||(l=[d(X,"mouseup",e[1]),d(X,"mousemove",e[4]),d(X,"mousedown",e[3]),d(X,"resize",e[2]),d(n,"resize",e[2])],i=!0)},p:t,i:t,o:t,d(t){t&&r(n),e[6](null),i=!1,o(l)}}}function B(t,e,n){let o,{canvas:i=null}=e,{ctx:l=null}=e;const c={x:0,y:0};function s(){l&&(n(5,l.canvas.width=window.innerWidth-i.offsetLeft-10,l),n(5,l.canvas.height=window.innerHeight-i.offsetTop-10,l))}function r(t){c.x=t.clientX-i.offsetLeft,c.y=t.clientY-i.offsetTop}x((()=>{n(5,l=i.getContext("2d")),s(),n(5,l.fillStyle="#FFFFFF",l),l.fillRect(0,0,l.canvas.width,l.canvas.height)}));return t.$$set=t=>{"canvas"in t&&n(0,i=t.canvas),"ctx"in t&&n(5,l=t.ctx)},[i,()=>{o=l.getImageData(0,0,i.width,i.height)},s,r,function(t){if(1!==t.buttons||c.x<0||c.y<0)return;const e=t.clientX-i.offsetLeft-1,s=t.clientY-i.offsetTop-1;l.beginPath(),n(5,l.lineWidth=O.lineWidth??5,l),n(5,l.lineCap="round",l),n(5,l.strokeStyle=O.strokeColor,l),n(5,l.fillStyle=O.fillColor,l),"pen"!==O.figure&&(l.clearRect(0,0,i.width,i.height),o&&l.putImageData(o,0,0)),q.find((t=>t.value===O.figure)).action(l,c,e,s,(()=>r(t))),l.stroke()},l,function(t){b[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class H extends I{constructor(t){super(),D(this,t,B,Y,l,{canvas:0,ctx:5,setCanvasScreenshot:1})}get canvas(){return this.$$.ctx[0]}set canvas(t){this.$$set({canvas:t}),E()}get ctx(){return this.$$.ctx[5]}set ctx(t){this.$$set({ctx:t}),E()}get setCanvasScreenshot(){return this.$$.ctx[1]}}function U(t,e,n){const o=t.slice();return o[3]=e[n],o}function G(t){let e,n,o,i,l,p=t[3].title+"";function $(){return t[2](t[3])}return{c(){e=a("button"),n=u(p),o=f(),h(e,"class","figure svelte-1esg3sx"),g(e,"active",t[0].figure===t[3].value)},m(t,r){s(t,e,r),c(e,n),c(e,o),i||(l=d(e,"click",$),i=!0)},p(n,o){t=n,1&o&&g(e,"active",t[0].figure===t[3].value)},d(t){t&&r(e),i=!1,l()}}}function J(e){let n,o=q,i=[];for(let t=0;t<o.length;t+=1)i[t]=G(U(e,o,t));return{c(){n=a("div");for(let t=0;t<i.length;t+=1)i[t].c()},m(t,e){s(t,n,e);for(let t=0;t<i.length;t+=1)i[t].m(n,null)},p(t,[e]){if(3&e){let l;for(o=q,l=0;l<o.length;l+=1){const c=U(t,o,l);i[l]?i[l].p(c,e):(i[l]=G(c),i[l].c(),i[l].m(n,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=o.length}},i:t,o:t,d(t){t&&r(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(i,t)}}}function K(t,e,n){const o=t=>{n(0,O.figure=t.value,O)};return[O,o,t=>o(t)]}class Q extends I{constructor(t){super(),D(this,t,K,J,l,{})}}function V(e){let n,i,l,u,g,v,m,x,y,b,w,C,k;return{c(){n=a("div"),i=a("input"),l=f(),u=a("input"),g=f(),v=a("input"),m=f(),x=a("div"),y=a("input"),b=f(),w=a("label"),w.textContent="С заливкой",h(i,"class","input-line-width svelte-r9uii6"),h(i,"type","number"),h(i,"placeholder","Толщина (px)"),h(u,"type","color"),h(u,"class","color-picker svelte-r9uii6"),h(v,"type","color"),h(v,"class","color-picker svelte-r9uii6"),h(y,"id","fillToggle"),h(y,"type","checkbox"),h(y,"class","svelte-r9uii6"),h(w,"for","fillToggle"),h(w,"class","svelte-r9uii6"),h(x,"class","fill-toggle svelte-r9uii6"),h(n,"class","panel-top svelte-r9uii6")},m(t,o){s(t,n,o),c(n,i),$(i,e[0].lineWidth),c(n,l),c(n,u),$(u,e[0].strokeColor),c(n,g),c(n,v),$(v,e[0].fillColor),c(n,m),c(n,x),c(x,y),y.checked=e[0].isFill,c(x,b),c(x,w),C||(k=[d(i,"input",e[1]),d(u,"input",e[2]),d(v,"input",e[3]),d(y,"change",e[4])],C=!0)},p(t,[e]){1&e&&p(i.value)!==t[0].lineWidth&&$(i,t[0].lineWidth),1&e&&$(u,t[0].strokeColor),1&e&&$(v,t[0].fillColor),1&e&&(y.checked=t[0].isFill)},i:t,o:t,d(t){t&&r(n),C=!1,o(k)}}}function Z(t,e,n){return[O,function(){O.lineWidth=p(this.value),n(0,O)},function(){O.strokeColor=this.value,n(0,O)},function(){O.fillColor=this.value,n(0,O)},function(){O.isFill=this.checked,n(0,O)}]}class tt extends I{constructor(t){super(),D(this,t,Z,V,l,{})}}function et(e){let n,i,l,u,p,$;return{c(){n=a("div"),i=a("button"),i.textContent="Сохранить",l=f(),u=a("button"),u.textContent="Очистить",h(i,"class","item svelte-t1d7r6"),h(u,"class","item svelte-t1d7r6"),h(n,"class","wrapper svelte-t1d7r6")},m(t,o){s(t,n,o),c(n,i),c(n,l),c(n,u),p||($=[d(i,"click",e[0]),d(u,"click",e[1])],p=!0)},p:t,i:t,o:t,d(t){t&&r(n),p=!1,o($)}}}function nt(t,e,n){let{canvas:o=null}=e,{ctx:i=null}=e,{setCanvasScreenshot:l=(()=>{})}=e;return t.$$set=t=>{"canvas"in t&&n(3,o=t.canvas),"ctx"in t&&n(2,i=t.ctx),"setCanvasScreenshot"in t&&n(4,l=t.setCanvasScreenshot)},[()=>{var t=document.createElement("a");t.download="paint.jpg",t.href=o.toDataURL(),t.click()},()=>{i&&(n(2,i.fillStyle="#FFFFFF",i),i.fillRect(0,0,i.canvas.width,i.canvas.height),l())},i,o,l]}class ot extends I{constructor(t){super(),D(this,t,nt,et,l,{canvas:3,ctx:2,setCanvasScreenshot:4})}}function it(t){let e,n,o,i,l,u,d,h,p,$;o=new ot({props:{canvas:t[0]?.canvas,ctx:t[0]?.ctx,setCanvasScreenshot:t[0]?.setCanvasScreenshot}}),l=new tt({}),d=new Q({});return p=new H({props:{}}),t[1](p),{c(){e=a("main"),n=a("div"),M(o.$$.fragment),i=f(),M(l.$$.fragment),u=f(),M(d.$$.fragment),h=f(),M(p.$$.fragment)},m(t,r){s(t,e,r),c(e,n),N(o,n,null),c(n,i),N(l,n,null),c(n,u),N(d,n,null),c(e,h),N(p,e,null),$=!0},p(t,[e]){const n={};1&e&&(n.canvas=t[0]?.canvas),1&e&&(n.ctx=t[0]?.ctx),1&e&&(n.setCanvasScreenshot=t[0]?.setCanvasScreenshot),o.$set(n);p.$set({})},i(t){$||(R(o.$$.fragment,t),R(l.$$.fragment,t),R(d.$$.fragment,t),R(p.$$.fragment,t),$=!0)},o(t){j(o.$$.fragment,t),j(l.$$.fragment,t),j(d.$$.fragment,t),j(p.$$.fragment,t),$=!1},d(n){n&&r(e),P(o),P(l),P(d),t[1](null),P(p)}}}function lt(t,e,n){let o=null;return[o,function(t){b[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}return new class extends I{constructor(t){super(),D(this,t,lt,it,l,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
